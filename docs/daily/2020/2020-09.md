# 2020-09

当你有一天在你的城市有了一片立足之地，你会发现原来一切都值得。

## 2020-09-03

- 生活
- 身体健康
- 工作方面

1.  问题反馈 sdk

    1. sdk 封装<daily-status />
    2. demo 页面<daily-status />
    3. 增加扩展字段，备注

- 个人能力

- 总结复盘

  1. 今天只完成一件事，sdk 的设计和基础架构的搭建

     1. sdk 的编写需要搭建一个调试环境，随时看到效果
     2. sdk 的自动化部署，使用 jenkins
     3. sdk 是异步加载的，在 sdk 加载完之前调用的 sdk 接口，也必须在 sdk 加载完成之后按顺序完成
     4. sdk 接口一律 promise 形式
     5. sdk 需要做兼容
     6. sdk 使用 jsonp 做请求的时候，错误情况的处理方式
        script 的 onerror 去监听
     7. sdk 使用 axios 进行网络请求，各种方式的参数传递
     8. vue-resource 的 emulateJSON ，在 axios 中，使用`qs.stringify({})`去传值，`npm install qs -s`,
        或者
        ```js
        transformRequest: [
          data => {
            let ret = "";
            for (let it in data) {
              ret +=
                encodeURIComponent(it) +
                "=" +
                encodeURIComponent(data[it]) +
                "&";
            }
            return ret;
          }
        ],
        ```
     9. log 日志：onError
     10. 接口的权限处理，很多接口需要登录才能使用
     11. 接口的并发（这个暂时没处理）
         相同接口的调用，一个未完成，另一个不能调用，或者一个未完成，另一个要调用，要强行中断前一个
     12. 接口的使用文档
     13. sdk 的 demo 页
     14. 接口的逐个调试
     15. 接口参数的校验（这个暂时没处理）
     16. sdk 的体积要尽量压缩，目前 43kb

  2. 今天的 sdk 给自己很多思路

     1. 明确的目标，在这里是 sdk 的设计使用，可以在 demo 页面上展示每个接口效果
     2. 创造一个舒适的环境，在这里是 sdk 的自动化部署和搭建调试环境，磨刀不误砍柴时，创建好环境才能进行快速开发迭代。
        之前在 faster 上编写，看效果异常艰难，而且不能引 npm 包，效率慢了 10 倍不止，精力和时间都要消耗殆尽了。
     3. 清晰的思路，之前的网络请求用 fetch，是原生的，目的是减少代码量，减少 sdk 体积，但是发现这个 sdk 和以往的埋点 sdk 不同，它有大量接口请求，而且请求的方式不同，传参方式也不同，
        如果在 fetch 的基础上实现，非常困难，果断改为 axios 和 jsonp，效果极佳，而且迈过了 vue-resource 的 emulateJSON 和 jsonp 的错误处理的坑之后，基本没有什么大的问题。
     4. 平时的积累
        sdk 是异步加载的，在 sdk 加载完之前调用的 sdk 接口，也必须在 sdk 加载完成之后按顺序完成，这个就是之前写埋点 sdk 的时候，研究诸葛 sdk 的实现掌握的，屡试不爽。
