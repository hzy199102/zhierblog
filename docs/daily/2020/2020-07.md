# 2020-07

我自横刀向天笑，去留肝胆两昆仑。

## 2020-07-15

- 生活
- 身体健康
- 工作方面
- 个人能力
- 总结复盘

1.  vue-ssr 的复习，以 vue-hackernews-2.0 源码为基础，尝试全面掌握核心。

    1.  `FriendlyErrorsPlugin`插件是友好错误提示插件
    2.  `nodeExternals`插件
        请注意，在 externals 选项中，我们将 CSS 文件列入白名单。这是因为从依赖模块导入的 CSS 还应该由 webpack 处理。如果你导入依赖于 webpack 的任何其他类型的文件（例如 _.vue, _.sass），那么你也应该将它们添加到白名单中。

        如果你使用 runInNewContext: 'once' 或 runInNewContext: true，那么你还应该将修改 global 的 polyfill 列入白名单，例如 babel-polyfill。这是因为当使用新的上下文模式时，**server bundle 中的代码具有自己的 global 对象。**由于在使用 Node 7.6+ 时，在服务器并不真正需要它，所以实际上只需在客户端 entry 导入它。

    3.  复习了 promise 的原理，并且帮我理解了一个非常重要的场景

        ```js
        const readyPromise = new Promise(r => {
          ready = r;
        });
        const update = () => {
          if (bundle && clientManifest) {
            ready();
            cb(bundle, {
              template,
              clientManifest
            });
          }
        };
        ```

        ```js
        app.get(
          "*",
          isProd
            ? render
            : (req, res) => {
                readyPromise.then(() => render(req, res));
              }
        );
        ```

        在参考[promise](@/docs/interview/js/promise.md)之后，我意识到，`readyPromise.then(() => render(req, res));`不会立刻执行，什么时候 run 呢？在 promise 的 state 为 PENDING 的时候，那必须是 resolve 被调用的时候，就是 ready 被调用的时候。只要 promise 的 state 不为 PENDING ，那么`readyPromise.then(() => render(req, res));`可以无限次被立即触发执行。这个使用场景发生在非常底层的逻辑应用上，比如一个 sdk 的异步加载，那么加载之前触发的 sdk 接口需要保存在队列中，等 sdk 加载完成之后一一触发，这个可以用 promise 去解决，promise 内部就有队列可以去存储调用的 sdk 接口列表，在确认 sdk 加载完成之后，立即触发队列的接口任务。

## 2020-07-16

- 生活
- 身体健康
- 工作方面
- 个人能力

1. 完成 vue-hackernews-2.0 源码的研读

   1. `const VueSSRServerPlugin = require('vue-server-renderer/server-plugin')`的作用
      网络并无详解，估计要看源码，这是将服务器的整个输出，构建为单个 JSON 文件的插件。默认文件名为 `vue-ssr-server-bundle.json`
   2. clientManifest 的概念理解

   3. 数据预取和状态

      1. `var a = [{b:1},{b:2},{c:3}];console.log(a.map(x=>x.b).filter(_=>_)); // [1, 2]`
         这个代码非常有价值，通过 map 改变数组内数据结构，在通过 filter 过滤不符合要求的数据结构。


    4. client,server,文件变化三端的监听文件变化的处理不一样
        `chokidar`插件专门处理文件变化，这里处理`template.html`
        无法理解client和server的监听手段不一样

    5.  Firebase

- 总结复盘

## 2020-07-16

- 生活
- 身体健康
- 工作方面

1. 完成 p6 接口转中台
   1. jenkins 搭建<daily-status />
   2. 中台测试环境数据录入<daily-status />
   3. 项目结构调整，适应各环境部署配置
      1. 双域名接口情况处理<daily-status />
         无法直接 copyP5 的结构调整经验，因为要保留原有的接口
         顺利解决，经分析只需要保留一个 op 的登录接口，其他均使用中台接口，然后 op 登录接口可以单独处理。
      2. QT 升级的影响
         P6 是 QT 升级版
      3. 接口 301 处理
         原有配置有 301 权限处理，这里统一采用 loginFail 事件监听，这个要处理下，包括 P5 也要加上
   4. 部分接口转中台
   5.

- 个人能力

1. 原型/继承知识点研读

- 总结复盘
