# 幻灯网页

## 项目背景

主打 PC 端的幻灯片网页，只有一个页面，切换不同的按钮在中心位置展示不同的视频，已经提供素材以及项目基本架子，预计耗时 1 天，1.5。

## 时间轴

1. 2020-06-14 13:30：正式接触这个项目
2. 2020-06-14 14:30：花费 1 小时了解了项目需求
3. 2020-06-14 15:00：确认接下项目，和金主谈工钱
4. 2020-06-14 15:30：工钱确认，开始着手开发
5. 2020-06-14 17:30：和需求确认下交付要求，主流 PC 端满足要求，移动端要求不高，估计可以不考虑，现在难点就在于 3,
   视频只是单纯放灯片式的播放，不需要进度条，也不需要声音，其实和 gif 没什么区别，只是需要清晰，以及可以指定从头播放，所以才选用 video。
6. 2020-06-14 18:30：遇到一个严重问题，播放一个 115M 的大视频，结果 cpu 飙升，网页非常卡顿，在对比 B 站的视频播放，却发现没有这个问题，最后定位发现是因为他们采用了视频 blob 格式播放。
   这种格式的视频会被分解成很多个小片段，这个链接下载的是一个包含多个小视频（ts 格式的视频）的链接集合，这样做的目的是：
   1. 可以方便切换分辨率（多个 ts 格式的视频支持无缝流畅播放，MP4 不行）；
   2. 可能就是防止下载吧；
   3. 解决视频卡顿问题，大视频本身受网络影响较大。
   4. 这个未经确认，但是 CPU 占用率不会太高，如果单纯的 mp4，哪怕是本地浏览器打开，cpu 占用率都要飙升到 50%
      这个现在已经确认，是视频源的问题，一个 115M 的 mp4 视频，只有 29s，所以无论它以何种形式播放，都会导致 CPU 飙升，我刚开始误以为是视频大的原因，后来才知道是视频大小和视频时长比例太大导致的。我用一个 150M，但是 20m 的视频，不论用什么网页播放技术，都不会有 cpu 飙升的问题。
      参考资料：[关于使用 video 标签时 src 网址 blob 类型的理解](https://blog.csdn.net/github_37195944/article/details/76187388?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase)
      [视频网站中 video 标签中的视频资源以 blob:http 呈现的探索](https://blog.csdn.net/xingyun89114/article/details/80699527?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase)
      [MediaSource 错误：无法在“ MediaSource”上执行“ endOfStream”：MediaSource 的 readyState 未“打开”。](http://www.ptbird.cn/mediadource-readyState-is-not-open.html)
   5. 使用 mp4，却发现出错，用 Bento4 工具转换，却发现出了另一个问题：[由于找不到 VCRUNTIME140_1.dll，无法继续执行代码。重新安装程序可能会解决此问题](https://blog.csdn.net/qq_42365534/article/details/102847013)，安装程序的时候耐心点...
      `.\mp4fragment.exe .\00.mp4 hzy.mp4` `.\mp4info.exe hzy.mp4`
      但是发现即使 hzy.mp4 已经是复合要求的 mp4，仍然有问题，后来放弃了，我认为还是 mp4 内容有问题。现在确认的确是视频源的问题，我又用了其他 mp4 视频，都没问题。
7. 2020-06-14 23:30：发现了流程上的问题，另外每个视频源都很类似，而且清晰度不高，对着 word 反复确认播放顺序，耗费了很多时间，另外做了一个代码优化，每次点击菜单按钮的时候，
   其他视频暂停且隐藏， 只有当前视频从头开始播放，这个设置核心是 video 组件的`play()`,`pause()`,`currentTime = 0`,以及定位的`firstElementChild`。
8. 2020-06-15 9:00：早上工作一小时，把整体 UI 完成，但是垂直居中问题有些复杂，先跳过了，提供一个版本给甲方，先让他们可以修正视频源。当我早上 9 点发第一版的时候，他们对我的效率表示震惊。
   此时我工作共耗时 9 小时。

   1. 3 个小时用在确认需求

      1. 只要一个 word 文档，而且写的部分逻辑不同
      2. 视频源不清晰，而且很类似，核对流程耗时

   2. 4 个小时为了解决视频播放导致 CPU 卡顿的问题，但是这个属于技术优化，从中了解了：

      1. video 标签中的视频资源以 blob:http 呈现
      2. Bento4 工具转换
      3. 视频播放暂停以及从头播放等基础操作
      4. 主要是视频源有问题导致我去查找这些问题，但是最终发现他们都无法解决视频源导致的 cpu 飙升以及视频卡顿的问题。而且这里耽误了那么多时间

   3. 2 个小时设置了整体 UI

      1. 垂直居中问题没解决

9. 2020-06-15 23:00: 花费 2 小时，完成了剩余的工作，主要包括视频上点击指定位置触发视频播放的功能。
10. 2020-06-15 24:00: 交付工作，用户发现一个不是问题的问题，经过反复确认才明白是用户觉得 2 个视频之间切换太快就会显得突兀。尝试加入 setTimeout 延迟去解决，但是更明显了。所以目前我还是不知道用户指的是什么问题，这让我有点焦躁。不过先暂时跳过，明天正式给甲方确认。
11. 2020-06-16 21:00：没等到反馈，有点焦虑，今天和介绍人聊天，发现要价少了，纠结。现在心情很复杂

## 难点

1. 需要适配各种尺寸的屏幕

   1. 用百分比处理，而非 px，这种简单的画面完全可以应对
   2. 主体视频部分是否垂直居中是唯一的难点

2. 只需要适配主流浏览器

   1. 因为不存在复杂的操作，所以适配比较方便

3. 有些按钮是动态显示在视频中的，相当于覆盖在指定视频的指定位置

   1. 这里我查看到图片有一个 map 标签可以处理指定位置的事件处理。但是很鸡肋，因为图片缩放的情况下就会失效，要动态计算位置。
   2. 放置悬浮的透明的 div 在视频上，一定要用百分比定位和设置宽高，这样才能在等比缩放的情况下保证位置的正确性
   3. 这里有个核心技巧，就是 div 的位置不一定要准确，因为常人一般就是点个大概的位置就 OK 了，除非是 2 个 div 位置非常相近，才要注意点。这样的话设置位置就不耗费太多精力了。

4. 点击按钮切换视频的时候视频需要重头开始播放

   1. 一些基础操作，调研下很快的。

5. 在移动端网页必须横屏展示

   ```css
   @media (orientation: portrait) {
     body {
       transform: rotate(90deg);
     }
   }
   ```

##
